<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, July 15, 2008, 11:06 AM -->
<!-- MuClient version 4.33 -->

<!-- Plugin "Aardwolf_Campaign_Noter" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Aardwolf_Campaign_Noter"
   author="Nick Gammon"
   id="2bfb7e23fb504ae4e55f0ed6"
   language="Lua"
   purpose="Shows remaining campaign objectives"
   date_written="2008-07-15 11:04:43"
   requires="4.33"
   version="1.0"
   save_state="y"
   >
<description trim="y">
<![CDATA[
Shows outstanding campaign objectives.

To activate, type: cp check
]]>
</description>

</plugin>


<!--  Triggers  -->

<triggers>
  <trigger
   match="You have * left to finish this campaign."
   name="cp_time"
   script="cp_time"
   sequence="100"
  >
  </trigger>
  <trigger
   match="You still have to kill *"
   name="campaign_item"
   script="campaign_item"
   sequence="100"
  >
  </trigger>
  
 <trigger
   enabled="y"
   match="Congratulations, that was one of your CAMPAIGN mobs!"
   send_to="10"
   sequence="100"
  >
  <send>cp check</send>
  </trigger>

 <trigger
   enabled="y"
   match="CONGRATULATIONS! You have completed your campaign."
   sequence="100"
   script="campaign_done"
  >
  </trigger>


</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   name="cp_check"
   script="cp_check"
   match="^(cp|campaign) check$"
   enabled="y"
   regexp="y"
   sequence="100"
  >
  <send>cp check</send>
  </alias>
</aliases>

<!--  Timers  -->

<timers>
  <timer script="get_notepad_position" 
         enabled="y" 
         second="10.00" 
         active_closed="y" >

  </timer>
</timers>

<!--  Script  -->


<script>
<![CDATA[

require "serialize"

pos = {}

function get_notepad_position (name)
  local newpos = GetNotepadWindowPosition ("Campaign")
  pos = newpos or pos
  
  if next (pos) then
    Left, Top, Width, Height = pos.left, pos.top, pos.width, pos.height
  end -- if 
end -- get_notepad_position

-- notepad position
Left, Top, Width, Height = 500, 200, 600, 600
MenuSize = 50

campaign_info = {}
 
function campaign_item (name, line, wildcards)
  table.insert (campaign_info, line)
end -- campaign_item

function campaign_done (name, line, wildcards)
  Send "score"
  CloseNotepad ("Campaign", false)
end -- campaign_done

function cp_time (name, line, wildcards)

  table.insert (campaign_info, line)
  
  check (EnableTrigger ("campaign_item", false))
  check (EnableTrigger ("cp_time", false))

  CloseNotepad ("Campaign", false)
  ReplaceNotepad ("Campaign", table.concat (campaign_info, "\r\n"))
  NotepadColour ("Campaign", "black", "#FFFFE7")
  NotepadSaveMethod ("Campaign", 2)  -- don't try to save
  
  local lines = #campaign_info + 1
  
  if lines < 40 then
    MoveNotepadWindow ("Campaign", Left, Top, Width, GetInfo (214) * lines + MenuSize)  
  else
    MoveNotepadWindow("Campaign", Left, Top, Width, Height)
  end -- if
  
  ActivateNotepad "Campaign"
  
  Activate ()
  
  NotepadReadOnly ("Campaign")
  
end -- cp_time

function cp_check( name, line, wildcards)
  check (EnableTrigger ("campaign_item", true))
  check (EnableTrigger ("cp_time", true))
  campaign_info = {}
  
end -- cp_check

function OnPluginSaveState ()
  get_notepad_position ()
  SetVariable ("pos", "pos = " .. serialize.save_simple (pos))
end -- function OnPluginSaveState

function OnPluginInstall ()
  assert (loadstring (GetVariable ("pos") or "")) ()
  
  if next (pos) then
    Left, Top, Width, Height = pos.left, pos.top, pos.width, pos.height
  end -- table not empty
  
end -- OnPluginInstall

]]>
</script>


<!--  Plugin help  -->

<aliases>
  <alias
   script="OnHelp"
   match="Aardwolf_Campaign_Noter:help"
   enabled="y"
  >
  </alias>
</aliases>

<script>
<![CDATA[
function OnHelp ()
  world.Note (world.GetPluginInfo (world.GetPluginID (), 3))
end
]]>
</script> 

</muclient>
